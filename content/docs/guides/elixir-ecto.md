---
title: Connect from Elixir with Ecto to Neon
subtitle: Set up a Neon project in seconds and connect from Elixir with Ecto
enableTableOfContents: true
isDraft: true
---

This guide describes how to connect from an Elixir app with Ecto. The instructions follow the steps outlined in the [Ecto Getting Started](https://hexdocs.pm/ecto/getting-started.html#content) guide, modified to demonstrate how to connect to Neon.

To connect to Neon from Elixir with Ecto:

## Create a database in Neon and copy the connection string

The instructions in this configuration use a database named `friends`.

To create the database:

1. Navigate to the [Neon Console](https://console.neon.tech).
1. Select a project.
1. Select **Databases**.
1. Select the branch where you want to create the database.
1. Click **New Database**.
1. Enter a database name (`friends` in this example), and select a database owner.
1. Click **Create**.

You can obtain the connection string for the database from the **Connection Details** widget on the Neon **Dashboard**. Select a branch, a role, and the database you want to connect to. A connection string is constructed for you. Your connection string should look something like this:

<CodeBlock shouldWrap>

```bash
postgres://<user>:<password>@ep-billowing-sun-767748.us-west-2.aws.neon.tech/friends
```

You will need the connection string details later in the setup.

</CodeBlock>

## Create an Elixir project

Following the _Ecto Getting Started_ example, create an application called `friends`.

```bash
mix new friends --sup
```

The `--sup` option ensures that the application has a supervision tree, which is required by Ecto.

## Add Ecto and Postgrex to the application

1. Add the Ecto and the Postgrex driver dependencies to the `mix.exs` file by updating the `deps` definition in the file to include those items. For example:

```bash
defp deps do
  [
    {:ecto_sql, "~> 3.0"},
    {:postgrex, ">= 0.0.0"}
  ]
end
```

Ecto provides the common querying API. The Postgrex driver acts as a bridge between Ecto and PostgreSQL. Ecto interfaces with its own `Ecto.Adapters.Postgres` module, which communicates to Postgres through the Postgrex driver.

2. Install the Ecto and the Postgrex driver dependencies by running the following command in your application directory:

```bash
mix deps.get
```

## Configure Ecto

Run the following command in your application directory to generate the configuration required to connect from Ecto to your Neon database.

```bash
mix ecto.gen.repo -r Friends.Repo
```

Follow these steps to complete the configuration:

1. The first part of the configuration generated by the `mix ecto.gen.repo` command is found in the `config/config.exs` file. Update this configuration with your Neon database connection details. For example:

    ```elixir
    config :friends, Friends.Repo,
    database: "friends",
    username: "<user>",
    password: "<password>",
    hostname: "ep-billowing-sun-767748.us-west-2.aws.neon.tech",
    ssl: true,
    ssl_opts: [
    server_name_indication: 'ep-billowing-sun-767748.us-west-2.aws.neon.tech'
    ]
    ```

    The `ssl: true` and `ssl_opts` settings are required to connect to Neon. Neon uses domain names provided via the Server Name Indication (SNI) extension of the TLS protocol to route incoming connections. Enabling `ssl` and setting `ssl_opts` with the `server_name_indication` option to your Neon domain name ensures that this information is passed to Neon when establishing a connection.

2. The second part of the configuration generated by the `mix ecto.gen.repo` command is the `Ecto.Repo` module, found in `lib/friends/repo.ex`. You shouldn't have to make any changes here, but verify that the following configuration is present:

    ```elixir
    defmodule Friends.Repo do
    use Ecto.Repo,
        otp_app: :friends,
        adapter: Ecto.Adapters.Postgres
    end
    ```

Ecto uses the module definition to query the database. The `otp_app` setting tells Ecto which Elixir application has the database configuration. In this case, the `:friends` application is specified, so Ecto will use the configuration defined in the that application's `config/config.exs` file. The `:adapter` option defines the Postgres adapter.

3. The last part of of configuration is setting up `Friends.Repo` as a supervisor within the application's supervision tree. In `lib/friends/application.ex`, specify `Friends.Repo` in the `start/2` function, as shown:

    ```elixir
    def start(_type, _args) do
    children = [
        Friends.Repo,
    ]
    ```

This configuration starts the Ecto process, enabling it to receive and execute the application's queries.

4. The final part of the configuration is to add the following line under the configuration in `config/config.exs` file, which you updated in the first step:

    ```elixir
    config :friends, ecto_repos: [Friends.Repo]
    ```

This line tells the application about the the new repo, allowing you to run commands such as `mix ecto.migrate`, which you will use in a later step to create a table in your database.

## Create a migration to add a table

Your `friends` database is currently empty. It has no tables or data. In this step, you will add a table. To do that, you will create a "migration". To create a migration, run the following command in your application directory:

```bash
mix ecto.gen.migration create_people
```

The command generates an empty migration file in `priv/repo/migrations`, which looks like this:

```bash
defmodule Friends.Repo.Migrations.CreatePeople do
  use Ecto.Migration

  def change do

  end
end
```

Add code to the migration file to create a table called `people`. For example:

```elixir
defmodule Friends.Repo.Migrations.CreatePeople do
  use Ecto.Migration

  def change do
    create table(:people) do
      add :first_name, :string
      add :last_name, :string
      add :age, :integer
    end
  end
end
```

To run this migration and create the `people` table in our database, which will also verify your connection to Neon, run the following command from your application directory:

```bash
mix ecto.migrate
```

You can use the Tables feature in Neon to verify that the table was created:

To view the data that you added, you can use the **Tables** feature in the Neon console, which allows you to explore the data in your Neon databases.

1. Navigate to the [Neon Console](https://console.neon.tech).
1. Select a project.
1. Select **Tables** from the sidebar. 
1. Select the Branch, Database (`friends`), and the schema (`public`, unless you created a different schema). You should see the `people` table created by the migration and a `schema_migration` table that was automatically created by the migration.

## Need help?

Send a request to [support@neon.tech](mailto:support@neon.tech), or join the [Neon community forum](https://community.neon.tech/).
